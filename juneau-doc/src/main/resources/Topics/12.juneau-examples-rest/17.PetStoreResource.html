<!--
/***************************************************************************************************************************
 * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *  
 *  http://www.apache.org/licenses/LICENSE-2.0
 *  
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations under the License.
 ***************************************************************************************************************************/
 -->

{todo} PetStoreResource

<p>
	The <code>PetStoreResource</code> class provides examples of the following: 
</p>
<ul	class='spaced-list'>
	<li>
		Summary and detail views of the same beans providing different levels of information.
	<li>
		The use of the {@link org.apache.juneau.html.HtmlRender} class.
	<li>
		The use of the {@link org.apache.juneau.annotation.BeanProperty#format @BeanProperty(format)} annotation.
	<li>
		The use of the {@link org.apache.juneau.rest.converters.Queryable} interface.
</ul>

<h5 class='figure'>PetStoreResource.java</h5>
<p class='bpcode w800'>
	<ja>@RestResource</ja>(
		title=<js>"Pet Store"</js>,
		description=<js>"An example of a typical REST resource where beans are rendered in summary and details views."</js>,
		path=<js>"/petstore"</js>,
		htmldoc=<ja>@HtmlDoc</ja>(
			widgets={
				ContentTypeMenuItem.<jk>class</jk>,
				StyleMenuItem.<jk>class</jk>,
				PetStoreResource.AddPet.<jk>class</jk>
			},
			navlinks={
				<js>"up: request:/.."</js>,
				<js>"options: servlet:/?method=OPTIONS"</js>,
				<js>"$W{ContentTypeMenuItem}"</js>,
				<js>"$W{StyleMenuItem}"</js>,
				<js>"source: $C{Source/gitHub}/org/apache/juneau/examples/rest/$R{servletClassSimple}.java"</js>,
				<js>"$W{AddPet}"</js>
			},
			aside={
				<js>"&lt;div style='max-width:400px' class='text'&gt;"</js>,
				<js>"	&lt;p&gt;This page shows a standard REST resource that renders bean summaries and details.&lt;/p&gt;"</js>,
				<js>"	&lt;p&gt;It shows how different properties can be rendered on the same bean in different views.&lt;/p&gt;"</js>,
				<js>"	&lt;p&gt;It also shows examples of HtmlRender classes and @BeanProperty(format) annotations.&lt;/p&gt;"</js>,
				<js>"	&lt;p&gt;It also shows how the Queryable converter and query widget can be used to create searchable interfaces.&lt;/p&gt;"</js>,
				<js>"&lt;/div&gt;"</js>
			},
			head={
				<js>"&lt;link rel='icon' href='$U{servlet:/htdocs/cat.png}'/&gt;"</js>
			}
		),
		staticFiles={<js>"htdocs:htdocs"</js>}
	)
	<jk>public class</jk> PetStoreResource <jk>extends</jk> BasicRestServletJena {
	
		<jc>// Our database.</jc>
		<jk>private</jk> Map&lt;Integer,Pet&gt; <jf>petDB</jf>;
	
		<ja>@RestHook</ja>(INIT) 
		<jk>public void</jk> initDatabase(RestContextBuilder builder) <jk>throws</jk> Exception {
			<jc>// Load our database from a local JSON file.</jc>
			<jf>petDB</jf> = JsonParser.<jsf>DEFAULT</jsf>.parse(
				getClass().getResourceAsStream(<js>"PetStore.json"</js>), LinkedHashMap.<jk>class</jk>, Integer.<jk>class</jk>, Pet.<jk>class</jk>
			);
		}
	
		<jc>// Exclude the 'breed' and 'getsAlongWith' properties from the beans.</jc>
		<ja>@RestMethod</ja>(
			name=<jsf>GET</jsf>,
			path=<js>"/"</js>,
			summary=<js>"The complete list of pets in the store"</js>,
			bpx=<js>"Pet: breed,getsAlongWith"</js>,
			
			<jc>// Add our converter for POJO query support.</jc>
			converters=Queryable.<jk>class</jk>,
			
			<jc>// Add our menu items in the nav links.</jc>
			htmldoc=<ja>@HtmlDoc</ja>(
				
				widgets={
					QueryMenuItem.<jk>class</jk>,
					ContentTypeMenuItem.<jk>class</jk>,
					StyleMenuItem.<jk>class</jk>
				},
	
				navlinks={
					<js>"INHERIT"</js>,  <jc>// Inherit links from class.</jc>
					<js>"[2]:$W{QueryMenuItem}"</js>  <jc>// Insert QUERY link in position 2.</jc>
				}
			)
		)
		<jk>public</jk> Collection&lt;Pet&gt; getPets() {
			<jk>return</jk> <jf>petDB</jf>.values();
		}
	
		<jc>// Shows all bean properties.</jc>
		<ja>@RestMethod</ja>(name=<jsf>GET</jsf>, path=<js>"/{id}"</js>, summary=<js>"Pet details"</js>)
		<jk>public</jk> Pet getPet(<ja>@Path</ja>(<js>"id"</js>) Integer id) {
			<jk>return</jk> <jf>petDB</jf>.get(id);
		}
	
		<ja>@RestMethod</ja>(name=<jsf>POST</jsf>, path=<js>"/"</js>)
		<jk>public</jk> Redirect addPet(<ja>@Body</ja> Pet pet) <jk>throws</jk> Exception {
			<jk>this</jk>.<jf>petDB</jf>.put(pet.<jf>id</jf>, pet);
			<jk>return new</jk> Redirect(<js>"servlet:/"</js>);
		}
		
		<jc>// Our bean class.</jc>
		<jk>public static class</jk> Pet {
	
			<ja>@Html</ja>(link=<js>"servlet:/{id}"</js>)  <jc>// Creates a hyperlink in HTML view.</jc>
			<ja>@NameProperty</ja>                <jc>// Links the parent key to this bean.</jc>
			<jk>public int</jk> <jf>id</jf>;
	
			<jk>public</jk> String <jf>name</jf>;
			<jk>public</jk> Kind <jf>kind</jf>;
			<jk>public</jk> String <jf>breed</jf>;
			<jk>public</jk> List&lt;Kind&gt; <jf>getsAlongWith</jf>;
	
			<ja>@BeanProperty</ja>(format=<js>"$%.2f"</js>)  <jc>// Renders price in dollars.</jc>
			<jk>public float</jk> <jf>price</jf>;
	
			<ja>@Swap</ja>(DateSwap.ISO8601D.<jk>class</jk>)  <jc>// Renders dates in ISO8601 format.</jc>
			<jk>public</jk> Date <jf>birthDate</jf>;
	
			<jk>public int</jk> getAge() {
				Calendar c = <jk>new</jk> GregorianCalendar();
				c.setTime(<jf>birthDate</jf>);
				<jk>return new</jk> GregorianCalendar().get(Calendar.<jsf>YEAR</jsf>) - c.get(Calendar.<jsf>YEAR</jsf>);
			}</jk>
		}
	
		<ja>@Html</ja>(render=KindRender.<jk>class</jk>)  <jc>// Render as an icon in HTML.</jc>
		<jk>public static enum</jk> Kind {
			<jsf>CAT</jsf>, <jsf>DOG</jsf>, <jsf>BIRD</jsf>, <jsf>FISH</jsf>, <jsf>MOUSE</jsf>, <jsf>RABBIT</jsf>, <jsf>SNAKE</jsf>
		}
	
		<jk>public static class</jk> KindRender <jk>extends</jk> HtmlRender&lt;Kind&gt; {
			<ja>@Override</ja>
			<jk>public</jk> Object getContent(SerializerSession session, Kind value) {
				<jk>return new</jk> Img().src(<js>"servlet:/htdocs/"</js>+value.toString().toLowerCase()+"<js>.png"</js>);
			}
			<ja>@Override</ja>
			<jk>public</jk> String getStyle(SerializerSession session, Kind value) {
				<jk>return</jk> <js>"background-color:#FDF2E9</js>";
			}
		}
		
		<jc>// Renders the "ADD" menu item.</jc>
		<jk>public class</jk> AddPet <jk>extends</jk> MenuItemWidget {
	
			<ja>@Override</ja>
			<jk>public</jk> String getLabel(RestRequest req) <jk>throws</jk> Exception {
				<jk>return</jk> <js>"add"</js>;
			}
	
			<ja>@Override</ja>
			<jk>public</jk> Object getContent(RestRequest req) <jk>throws</jk> Exception {
				<jk>return</jk> <jsm>div</jsm>(
					<jsm>form</jsm>().id(<js>"form"</js>).action(<js>"servlet:/"</js>).method(<jsf>POST</jsf>).children(
						<jsm>table</jsm>(
							<jsm>tr</jsm>(
								<jsm>th</jsm>(<js>"ID:"</js>),
								<jsm>td</jsm>(<jsm>input</jsm>().name(<js>"id"</js>).type(<js>"number"</js>).value(<jsm>getNextAvailableId</jsm>())),
								<jsm>td</jsm>(<jk>new</jk> Tooltip(<js>"(?)"</js>, <js>"A unique identifer for the pet."</js>, <jsm>br</jsm>(), <js>"Must not conflict with existing IDs"</js>))
							),
							<jsm>tr</jsm>(
								<jsm>th</jsm>(<js>"Name:"</js>),
								<jsm>td</jsm>(<jsm>input</jsm>().name(<js>"name"</js>).type(<js>"text"</js>)),
								<jsm>td</jsm>(<jk>new</jk> Tooltip(<js>"(?)"</js>, <js>"The name of the pet."</js>, <jsm>br</jsm>(), <js>"e.g. 'Fluffy'"</js>)) 
							),
							<jsm>tr</jsm>(
								<jsm>th</jsm>(<js>"Kind:"</js>),
								<jsm>td</jsm>(
									<jsm>select</jsm>().name(<js>"kind"</js>).children(
										<jsm>option</jsm>(<js>"CAT"</js>), 
										<jsm>option</jsm>(<js>"DOG"</js>), 
										<jsm>option</jsm>(<js>"BIRD"</js>), 
										<jsm>option</jsm>(<js>"FISH"</js>), 
										<jsm>option</jsm>(<js>"MOUSE"</js>), 
										<jsm>option</jsm>(<js>"RABBIT"</js>), 
										<jsm>option</jsm>(<js>"SNAKE"</js>)
									)
								),
								<jsm>td</jsm>(<jk>new</jk> Tooltip(<js>"(?)"</js>, <js>"The kind of animal."</js>)) 
							),
							<jsm>tr</jsm>(
								<jsm>th</jsm>(<js>"Breed:"</js>),
								<jsm>td</jsm>(<jsm>input</jsm>().name(<js>"breed"</js>).type(<js>"text"</js>)),
								<jsm>td</jsm>(<jk>new</jk> Tooltip(<js>"(?)"</js>, <js>"The breed of animal."</js>, <jsm>br</jsm>(), <js>"Can be any arbitrary text"</js>)) 
							),
							<jsm>tr</jsm>(
								<jsm>th</jsm>(<js>"Gets along with:"</js>),
								<jsm>td</jsm>(<jsm>input</jsm>().name(<js>"getsAlongWith"</js>).type(<js>"text"</js>)),
								<jsm>td</jsm>(<jk>new</jk> Tooltip(<js>"(?)"</js>, <js>"A comma-delimited list of other animal types that this animal gets along with."</js>)) 
							),
							<jsm>tr</jsm>(
								<jsm>th</jsm>(<js>"Price:"</js>),
								<jsm>td</jsm>(<jsm>input</jsm>().name(<js>"price"</js>).type(<js>"number"</js>).placeholder(<js>"1.0"</js>).step(<js>"0.01"</js>).min(1).max(100)),
								<jsm>td</jsm>(<jk>new</jk> Tooltip(<js>"(?)"</js>, <js>"The price to charge for this pet."</js>)) 
							),
							<jsm>tr</jsm>(
								<jsm>th</jsm>(<js>"Birthdate:"</js>),
								<jsm>td</jsm>(<jsm>input</jsm>().name(<js>"birthDate"</js>).type(<js>"date"</js>)),
								<jsm>td</jsm>(<jk>new</jk> Tooltip(<js>"(?)"</js>, <js>"The pets birthday."</js>)) 
							),
							<jsm>tr</jsm>(
								<jsm>td</jsm>().colspan(2).style(<js>"text-align:right"</js>).children(
									<jsm>button</jsm>(<js>"reset"</js>, <js>"Reset"</js>),
									<jsm>button</jsm>(<js>""button"</js>, <js>"Cancel"</js>).onclick(<js>"window.location.href='/'"</js>),
									<jsm>button</jsm>(<js>"submit"</js>, <js>"Submit"</js>)
								)
							)
						).style(<js>"white-space:nowrap"</js>)
					)
				);
			}
		}
	}
<p>
	Pointing a browser to the resource shows the following:
</p>
<p class='bpcode w800'>
	http://localhost:10000/petstore
</p>			
<img class='bordered w800' src='doc-files/juneau-examples-rest.PetStoreResource.1.png'>
<p>
	Clicking the <code>QUERY</code> link renders the following menu pop-up complete with tooltips:
</p>
<img class='bordered w800' src='doc-files/juneau-examples-rest.PetStoreResource.2.png'>
<p>
	The <code>STYLES</code> menu item allows you to try out the other default look-and-feels:
</p>
<h5 class='figure'>Light look-and-feel</h5>
<img class='bordered w800' src='doc-files/juneau-examples-rest.PetStoreResource.3.png'>
<h5 class='figure'>Dark look-and-feel</h5>
<img class='bordered w800' src='doc-files/juneau-examples-rest.PetStoreResource.4.png'>
