<!--
/***************************************************************************************************************************
 * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *  
 *  http://www.apache.org/licenses/LICENSE-2.0
 *  
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations under the License.
 ***************************************************************************************************************************/
 -->

RequestEchoResource

<p>
	The <l>RequestEchoResource</l> class shows how existing complex POJOs can be serialized to a variety of 
	content types.
	The example simply takes the incoming <l>HttpServletRequest</l> object and serializes it. 
</p>
<p>
	It provides examples of the following:
</p>
<ul class='spaced-list'>
	<li>
		Using the {@link org.apache.juneau.rest.annotation.RestResource#properties() @RestResource.properties()}
		annotation to set serializer properties.
	<li>
		Using the {@link org.apache.juneau.rest.annotation.RestResource#beanFilters() @RestResource.beanFilters()} 
		and {@link org.apache.juneau.rest.annotation.RestResource#pojoSwaps() @RestResource.pojoSwaps()}
		annotations to set serializer transforms.
	<li>
		Simply passing in an {@link org.apache.juneau.ObjectMap} parameter on the Java method.
		<br>This object map contains the modifiable properties on the request. 
</ul>
<p>
	The class is shown below:
</p>

<h5 class='figure'>RequestEchoResource.java</h5>
<p class='bcode w800'>
	<jd>/** 
	 * Sample REST resource for echoing HttpServletRequests back to the browser
	 */</jd>
	<ja>@RestResource</ja>(
		path=<js>"/echo"</js>,
		title=<js>"Request echo service"</js>,
		description=<js>"Echos the current HttpServletRequest object back to the browser."</js>,
		htmldoc=<ja>@HtmlDoc</ja>(
			widgets={
				ContentTypeMenuItem.<jk>class</jk>,
				StyleMenuItem.<jk>class</jk>
			},
			navlinks={
				<js>"up: request:/.."</js>,
				<js>"options: servlet:/?method=OPTIONS"</js>,
				<js>"$W{ContentTypeMenuItem}"</js>,
				<js>"$W{StyleMenuItem}"</js>,
				<js>"source: $C{Source/gitHub}/org/apache/juneau/examples/rest/$R{servletClassSimple}.java"</js>
			},
			aside={
				<js>"&lt;div style='max-width:400px;min-width:200px' class='text'&gt;"</js>,
				<js>"	&lt;p&gt;Shows how even arbitrary POJOs such as &lt;code&gt;HttpServletRequest&lt;/code&gt; can be serialized by the framework.&lt;/p&gt;"</js>,
				<js>"	&lt;p&gt;Also shows how to specify serializer properties, filters, and swaps at the servlet level to control how POJOs are serialized.&lt;/p&gt;"</js>,
				<js>"	&lt;p&gt;Also provides an example of how to use the Traversable and Queryable APIs.&lt;/p&gt;"</js>,
				<js>"&lt;/div&gt;"</js>
			}
		),
		properties={
			<ja>@Property</ja>(name=<jsf>SERIALIZER_maxDepth</jsf>, value=<js>"5"</js>),
			<ja>@Property</ja>(name=<jsf>SERIALIZER_detectRecursions</jsf>, value="<js>true"</js>)
		},
		beanFilters={
			<jc>// Interpret these as their parent classes, not subclasses</jc>
			HttpServletRequest.<jk>class</jk>, HttpSession.<jk>class</jk>, ServletContext.<jk>class</jk>,
		},
		pojoSwaps={
			<jc>// Add a special filter for Enumerations</jc>
			EnumerationSwap.<jk>class</jk>
		}
	)
	<jk>public class</jk> RequestEchoResource <jk>extends</jk> BasicRestServlet {
	
		<jd>/** GET request handler */</jd>
		<ja>@RestMethod</ja>(name=<jsf>GET</jsf>, path=<js>"/*"</js>, converters={Queryable.<jk>class</jk>,Traversable.<jk>class</jk>})
		<jk>public</jk> HttpServletRequest doGet(RestRequest req, RestResponse res, ObjectMap properties) {
			<jc>// Set the HtmlDocSerializer title programmatically.</jc>
			res.setPageTitle(req.getPathInfo());
			
			<jc>// Just echo the request back as the response.</jc>
			<jk>return</jk> req;
		}
	}
</p>
<p>
	Again, there's a lot going on here that's new that requires some explanation.
	<br>The <l>HttpServletRequest</l> object is not a tree-shaped POJO model.  
	<br>Instead, it contains lots of loops that can cause stack overflow errors if you were to try to serialize it as-is.
	<br>Also, you want to look only at the properties defined on the <l>HttpServletRequest</l> class, 
	not implementation-specific (i.e. WAS or Jetty) fields which can get messy.
</p>
<p>
	The {@link org.apache.juneau.rest.annotation.RestResource#properties() @RestResource.properties()}, 
		{@link org.apache.juneau.rest.annotation.RestResource#beanFilters() @RestResopurce.beanFilters()}, and
		{@link org.apache.juneau.rest.annotation.RestResource#pojoSwaps() @RestResopurce.pojoSwaps()} 
		annotations are used to set behavior properties on the resource's underlying bean context, serializers, 
		and parsers.  
	<br>You're using them here to modify the behavior of serialization for all content types.  
	<br>The annotations are functionally equivalent to using the {@link org.apache.juneau.rest.RestContextBuilder} class, 
	as follows:
</p>

<h5 class='figure'>Hypothetical RequestEchoResource.createSerializers() method</h5>
<p class='bcode w800'>
	<jd>/** Override the default rest serializers to add some transforms through an INIT hook*/</jd>
	<ja>@RestHook</ja>(<jsf>INIT</jsf>)
	<jk>public void</jk> init(RestContextBuilder builder) throws Exception {
		<jc>// Add bean filters for the HttpServletRequest, HttpSession, and ServletContext objects
		//		so that you don't show vendor-specific properties on subclasses.
		// Add Enumeration POJO swap to be able to render the contents of Enumeration properties.
		// The max depth and detect recursion options prevent any possible runaway serializations.  
		// This shouldn't happen, but future JEE APIs may introduce deep hierarchies or loops.</jc>
		builder
			.beanFilters(HttpServletRequest.<jk>class</jk>, HttpSession.<jk>class</jk>, ServletContext.<jk>class</jk>)
			.pojoSwaps(EnumerationSwap.<jk>class</jk>)
			.setProperty(<jsf>SERIALIZER_maxDepth</jsf>, 5)
			.setProperty(<jsf>SERIALIZER_detectRecursions</jsf>, <jk>true</jk>)
			.pageLinks(<js>"{...}"</js>);
	}
</p>
<p>
	Note how the annotations generally require fewer lines of code.
</p>
<p>
	Pointing a browser to the resource shows the following:
</p>

<p class='bcode w800'>
	http://localhost:10000/echo
</p>			
<img class='bordered w800' src='doc-files/juneau-examples-rest.RequestEchoResource.1.png'>
<p>
	This gives you an idea of what kinds of POJO models can be serialized, since you are serializing a regular 
	old <l>HttpServletRequest</l> object.
</p>
