<!--
/***************************************************************************************************************************
 * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *  
 *  http://www.apache.org/licenses/LICENSE-2.0
 *  
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations under the License.
 ***************************************************************************************************************************/
 -->

{todo} Server Side

<p>
	The server side is only slightly more complex, but boasts useful debugging and discovery capabilities.  
</p>
<p>
	The {@link org.apache.juneau.rest.remote.RemoteInterfaceServlet} class is an implementation of 
	{@link org.apache.juneau.rest.RestServlet} that provides a REST interface for invoking calls on POJOs.
	<br>The <code>RemoteInterfaceServlet</code> class is abstract and must implement a single method for providing the set 
	of POJOs to expose as remote interfaces.  
</p>
<p>
	The samples bundle includes a sample implementation of a remote interface service that can be used to interact with 
	the address book POJO also included in the bundle.  
	<br>The method that must be implemented is {@link org.apache.juneau.rest.remote.RemoteInterfaceServlet#getServiceMap()}
	that simply returns a mapping of Java interfaces (or classes) to POJO instances.
</p>
<p class='bpcode w800'>
	<ja>@RestResource</ja>(
		path=<js>"/remote"</js>
	)
	<jk>public class</jk> SampleRemoteInterfaceServlet <jk>extends</jk> RemoteInterfaceServlet {
	
		<jc>// The POJO being manipulated (i.e. the remote service)</jc>
		AddressBook <jf>addressBook</jf> = <jk>new</jk> AddressBook();
	
		<ja>@Override</ja> <jc>/* RemoteInterfaceServlet */</jc>
		<jk>protected</jk> Map&lt;Class&lt;?&gt;,Object&gt; getServiceMap() <jk>throws</jk> Exception {
			Map&lt;Class&lt;?&gt;,Object&gt; m = <jk>new</jk> LinkedHashMap&lt;Class&lt;?&gt;,Object&gt;();
	
			<jc>// In this simplified example, we expose the same POJO service under two different interfaces.
			// One is IAddressBook which only exposes methods defined on that interface, and
			// the other is AddressBook itself which exposes all public methods defined on the class itself.</jc>
			m.put(IAddressBook.<jk>class</jk>, addressBook);
			m.put(AddressBook.<jk>class</jk>, addressBook);
			<jk>return</jk> m;
		}
	}
</p>
<p>
	Since this class is a servlet, and can be deployed as such.  
	<br>In the sample code, it's listed as a child resource to <code>org.apache.juneau.rest.samples.RootResources</code>
		which makes it available under the URL <code>/sample/remote</code>.
</p>
<p>
	If you point your browser to that URL, you get a list of available interfaces:
</p>
<p class='bpcode w800'>
	http://localhost:10000/remote
</p>
<img class='bordered w800' src='doc-files/juneau-rest-server.RemoteInterfacesServerSide.1.png'>
<p>
	Clicking the hyperlinks on each shows you the list of methods that can be invoked on that service.
	<br>Note that the <code>IAddressBook</code> link shows that you can only invoke methods defined on that
	interface, whereas the <code>AddressBook</code> link shows ALL public methods defined on that class.
</p>
<h5 class='figure'>IAddressBook</h5>
<p class='bpcode w800'>
	http://localhost:10000/remote/org.apache.juneau.examples.addressbook.IAddressBook
</p>
<img class='bordered w800' src='doc-files/juneau-rest-server.RemoteInterfacesServerSide.2.png'>
<p>
	Since <code>AddressBook</code> extends from <code>LinkedList</code>, you may notice familiar collections
	framework methods listed.
</p>
<h5 class='figure'>AddressBook</h5>
<p class='bpcode w800'>
	http://localhost:10000/remote/org.apache.juneau.examples.addressbook.AddressBook
</p>
<img class='bordered w800' src='doc-files/juneau-rest-server.RemoteInterfacesServerSide.3.png'>
<p>
	Let's see how we can interact with this interface through nothing more than REST calls to get a better idea on 
	how this works.
	<br>We'll use the same method call as in the introduction.
	<br>First, we need to create the serialized form of the arguments:
</p>
<p class='bpcode w800'>
	Object[] args = <jk>new</jk> Object[] {
		<jk>new</jk> CreatePerson(<js>"Test Person"</js>,
			AddressBook.<jsm>toCalendar</jsm>(<js>"Aug 1, 1999"</js>),
			<jk>new</jk> CreateAddress(<js>"Test street"</js>, <js>"Test city"</js>, <js>"Test state"</js>, 12345, <jk>true</jk>))
	};
	String asJson = SimpleJsonSerializer.<jsf>DEFAULT_READABLE</jsf>.toString(args);
	System.<jsf>err</jsf>.println(asJson);
</p>
<p>
	That produces the following JSON output:
</p>
<p class='bpcode w800'>
	[
		{
			name: <js>'Test Person'</js>, 
			birthDate: <js>'Aug 1, 1999'</js>, 
			addresses: [
				{
					street: <js>'Test street'</js>, 
					city: <js>'Test city'</js>, 
					state: <js>'Test state'</js>, 
					zip: 12345, 
					isCurrent: <jk>true</jk>
				}
			]
		}
	]	
</p>
<p>
	Note that in this example we're using JSON.  
	<br>However, various other content types can also be used such as XML, URL-Encoding, UON, or HTML.  
	<br>In practice however, JSON will preferred since it is often the most efficient.
</p>
<p>
	Next, we can use a tool such as Poster to make the REST call.
	<br>Methods are invoked by POSTing the serialized object array to the URI of the interface method.
	In this case, we want to POST our JSON to the following URL:
</p>
<p class='bpcode w800'>
	http://localhost:10000/remote/org.apache.juneau.examples.addressbook.IAddressBook/createPerson(org.apache.juneau.examples.addressbook.CreatePerson)
</p>
<p>
	<br>Make sure that we specify the <code>Content-Type</code> of the body as <code>text/json</code>.
	<br>We also want the results to be returned as JSON, so we set the <code>Accept</code> header to 
	<code>text/json</code> as well.
</p>
<img class='bordered w400' src='doc-files/juneau-rest-server.RemoteInterfacesServerSide.4.png'>
<p>
	When we execute the POST, we should see the following successful response whose body contains the returned 
	<code>Person</code> bean serialized to JSON:
</p>
<img class='bordered w400' src='doc-files/juneau-rest-server.RemoteInterfacesServerSide.5.png'>
<p>
	From there, we could use the following code snippet to reconstruct the response object from JSON:
</p>
<p class='bpcode w800'>
	String response = <js>"<i>output from above</i>"</js>;
	Person p = JsonParser.<jsf>DEFAULT</jsf>.parse(response, Person.<jk>class</jk>);
</p>
<p>
	If we alter our servlet to allow overloaded GET requests, we can invoke methods using nothing more than a 
	browser...
</p>
<p class='bpcode w800'>
	<ja>@RestResource</ja>(
		path=<js>"/remote"</js>,
		
		<jc>// Allow us to use method=POST from a browser.</jc>
		allowedMethodParams=<js>"*"</js>
	)
	<jk>public class</jk> SampleRemoteInterfaceServlet <jk>extends</jk> RemoteInterfaceServlet {
</p>
<p>
	For example, to invoke the <code>getPeople()</code> method on our bean:
</p>
<p class='bpcode w800'>
	http://localhost:10000/remote/org.apache.juneau.examples.addressbook.IAddressBook/getPeople?method=POST
</p>			
<img class='bordered w800' src='doc-files/juneau-rest-server.RemoteInterfacesServerSide.6.png'>
<p>
	Here we call the <code>findPerson(<jk>int</jk>)</code> method to retrieve a person and get the 
	returned POJO (in this case as HTML since that's what's in the <code>Accept</code> header when calling from a 
	browser):
</p>
<p class='bpcode w800'>
	http://localhost:10000/remote/org.apache.juneau.examples.addressbook.IAddressBook/findPerson(int)?method=POST&amp;body=@(3)
</p>			
<img class='bordered w800' src='doc-files/juneau-rest-server.RemoteInterfacesServerSide.7.png'>
<p>
	When specifying the POST body as a <code>&amp;body</code> parameter, the method arguments should be in UON 
	notation.
	<br>See {@link org.apache.juneau.uon.UonSerializer} for more information about this encoding.
	<br>Usually you can also pass in JSON if you specify <code>&amp;Content-Type=text/json</code> in the URL parameters
	but passing in unencoded JSON in a URL may not work in all browsers.  
	<br>Therefore, UON is preferred.
</p>
<p>
	The hyperlinks on the method names above lead you to a simple form-entry page where you can test
	passing parameters in UON notation as URL-encoded form posts.
</p>
<h5 class='figure'>Sample form entry page</h5>
<img class='bordered w800' src='doc-files/juneau-rest-server.RemoteInterfacesServerSide.8.png'>
<h5 class='figure'>Sample form entry page results</h5>
<img class='bordered w800' src='doc-files/juneau-rest-server.RemoteInterfacesServerSide.9.png'>
