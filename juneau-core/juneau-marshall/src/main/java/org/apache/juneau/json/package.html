<!DOCTYPE HTML>
<!--
/***************************************************************************************************************************
 * Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.  See the NOTICE file
 * distributed with this work for additional information regarding copyright ownership.  The ASF licenses this file
 * to you under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance
 * with the License.  You may obtain a copy of the License at
 *  
 *  http://www.apache.org/licenses/LICENSE-2.0
 *  
 * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.  See the License for the
 * specific language governing permissions and limitations under the License.
 *
 ***************************************************************************************************************************/
 -->
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<style type="text/css">
		/* For viewing in Page Designer */
		@IMPORT url("../../../../../../javadoc.css");

		/* For viewing in REST interface */
		@IMPORT url("../htdocs/javadoc.css");
		body { 
			margin: 20px; 
		}	
	</style>
	<script>
		/* Replace all @code and @link tags. */	
		window.onload = function() {
			document.body.innerHTML = document.body.innerHTML.replace(/\{\@code ([^\}]+)\}/g, '<code>$1</code>');
			document.body.innerHTML = document.body.innerHTML.replace(/\{\@link (([^\}]+)\.)?([^\.\}]+)\}/g, '<code>$3</code>');
		}
	</script>
</head>
<body>
<p>JSON Marshalling Support</p>
<script>
	function toggle(x) {
		var div = x.nextSibling;
		while (div != null && div.nodeType != 1)
			div = div.nextSibling;
		if (div != null) {
			var d = div.style.display;
			if (d == 'block' || d == '') {
				div.style.display = 'none';
				x.className += " closed";
			} else {
				div.style.display = 'block';
				x.className = x.className.replace(/(?:^|\s)closed(?!\S)/g , '' );
			}
		}
	}
</script>

<a id='TOC'></a><h5 class='toc'>Table of Contents</h5>
<ol class='toc'>
	<li><p><a class='doclink' href='#Overview'>JSON support overview</a></p> 
	<ol>
		<li><p><a class='doclink' href='#OverviewExample'>Example</a></p>
	</ol>
	<li><p><a class='doclink' href='#JsonSerializer'>JsonSerializer class</a></p> 
	<ol>
		<li><p><a class='doclink' href='#JsonSchemaSupport'>JSON-Schema support</a></p>
		<li><p><a class='doclink' href='#SerializerOtherNotes'>Other notes</a></p>
	</ol>
	<li><p><a class='doclink' href='#JsonParser'>JsonParser class</a></p> 
</ol>

<!-- ======================================================================================================== -->
<a id="Overview"></a>
<h2 class='topic' onclick='toggle(this)'>1 -JSON support overview</h2>
<div class='topic'>

	<!-- ======================================================================================================== -->
	<a id="OverviewExample"></a>
	<h3 class='topic' onclick='toggle(this)'>1.1 - JSON support overview - example</h3>
	<div class='topic'>
		<p>
			The example shown here is from the Address Book resource located in the 
			<code>org.apache.juneau.sample.war</code> application.
			<br>The POJO model consists of a <code>List</code> of <code>Person</code> beans, with each <code>Person</code> 
			containing zero or more <code>Address</code> beans.
		</p>
		<p>
			When you point a browser at <code>/sample/addressBook</code>, the POJO is rendered as HTML:
		</p>
		<img class='bordered' src="doc-files/Example_HTML.png">
		<p>
			By appending <code>?Accept=<i>mediaType</i>&amp;plainText=true</code> to the URL, you can view the data in 
			the various supported JSON formats:
		</p>
		
		<h5 class='figure'>Normal JSON</h5>
		<img class='bordered' src="doc-files/Example_JSON.png">
		
		<h5 class='figure'>Simple JSON</h5>
		<img class='bordered' src="doc-files/Example_JSONSimple.png">

		<p>
			In addition to serializing POJOs to JSON, Juneau includes support for serializing POJO metamodels to 
			JSON Schema.
		</p>
		
		<h5 class='figure'>JSON Schema</h5>
		<img class='bordered' src="doc-files/Example_JSONSchema.png">
		
		<p>
			The JSON data type produced depends on the Java object type being serialized.
		</p>
		<ul class='spaced-list'>
			<li>
				Primitives and primitive objects are converted to JSON primitives.
			<li>
				Beans and Maps are converted to JSON objects.
			<li>
				Collections and arrays are converted to JSON arrays.
			<li>
				Anything else is converted to JSON strings.
		</ul>
			
		<h5 class='topic'>Examples:</h5>
		<table class='styled'>
			<tr>
				<th>POJO type</th>
				<th>Example</th>
				<th>Serialized form</th>
			</tr>
			<tr>
				<td>String</td>
				<td><code>serializer.serialize(<js>"foobar"</js>);</code></td>
				<td><code><js>'foobar'</js></code>
			</tr>
			<tr>
				<td>Number</td>
				<td><code>serializer.serialize(123);</code></td>
				<td><code><jk>123</jk></code>
			</tr>
			<tr>
				<td>Boolean</td>
				<td><code>serializer.serialize(<jk>true</jk>);</code></td>
				<td><code><jk>true</jk></code>
			</tr>
			<tr>
				<td>Null</td>
				<td><code>serializer.serialize(<jk>null</jk>);</code></td>
				<td><code><jk>null</jk></code>
			</tr>
			<tr>
				<td>Beans with properties of any type on this list</td>
				<td><code>serializer.serialize(<jk>new</jk> MyBean());</code></td>
				<td><code>{p1:<js>'val1'</js>,p2:<jk>true</jk>}</code>
			</tr>
			<tr>
				<td>Maps with values of any type on this list</td>
				<td><code>serializer.serialize(<jk>new</jk> TreeMap());</code></td>
				<td><code>{key1:<js>'val1'</js>,key2:<jk>true</jk>}</code>
			</tr>
			<tr>
				<td>Collections and arrays of any type on this list</td>
				<td><code>serializer.serialize(<jk>new</jk> Object[]{1,<js>"foo"</js>,<jk>true</jk>});</code></td>
				<td><code>[1,'foo',true]</code>
			</tr>
		</table>
		<p>
			In addition, swaps can be used to convert non-serializable POJOs into serializable forms, such as converting 
			<code>Calendar</code> object to ISO8601 strings, or <code><jk>byte</jk>[]</code> arrays to Base-64 
			encoded strings.
			<br>These swaps can be associated at various levels:
		</p>
		<ul class='spaced-list'>
			<li>
				On serializer and parser instances to handle all objects of the class type globally.
			<li>
				On classes through the <code><ja>@Bean</ja></code> annotation.
			<li>
				On bean properties through the <code><ja>@BeanProperty</ja></code> annotations.
		</ul>
	</div>
</div>

<!-- ======================================================================================================== -->
<a id="JsonSerializer"></a>
<h2 class='topic' onclick='toggle(this)'>2 - JsonSerializer class</h2>
<div class='topic'>
	<p>
		{@link org.apache.juneau.json.JsonSerializer} is the class used to convert POJOs to JSON.
		<br>{@link org.apache.juneau.json.JsonSchemaSerializer} is the class used to generate JSON-Schema from POJOs.
	</p>	
	<p>
		The JSON serializer includes several configurable settings.
		<br>Static reusable instances of Json serializers are provided with commonly-used settings:
	</p>
	<ul class='spaced-list'>
		<li>
			{@link org.apache.juneau.json.JsonSerializer#DEFAULT} - All default settings
		<li>
			{@link org.apache.juneau.json.JsonSerializer#DEFAULT_LAX} - Single quotes, only quote attributes when 
			necessary.
		<li>
			{@link org.apache.juneau.json.JsonSerializer#DEFAULT_LAX_READABLE} - Readable output.
	</ul>
	
	<h5 class='topic'>Notes about examples</h5>
	<p>
		The examples shown in this document will use single-quote, readable settings.
		<br>For brevity, the examples will use public fields instead of getters/setters to reduce the size of the examples.
		<br>In the real world, you'll typically want to use standard bean getters and setters.
	</p>
	<p>
		To start off simple, we'll begin with the following simplified bean and build upon it.
	</p>
	<p class='bcode'>
	<jk>public class</jk> Person {
		<jc>// Bean properties</jc>
		<jk>public int</jk> <jf>id</jf>;
		<jk>public</jk> String <jf>name</jf>;

		<jc>// Bean constructor (needed by parser)</jc>
		<jk>public</jk> Person() {}

		<jc>// Normal constructor</jc>
		<jk>public</jk> Person(<jk>int</jk> id, String name) {
			<jk>this</jk>.<jf>id</jf> = id;
			<jk>this</jk>.<jf>name</jf> = name;
		}
	}
	</p>
	<p>
		The following code shows how to convert this to simple JSON:
	</p>
	<p class='bcode'>
	<jc>// Use serializer with readable output, simple mode.</jc>
	JsonSerializer s = JsonSerializer.<jsf>DEFAULT_LAX_READABLE</jsf>;

	<jc>// Create our bean.</jc>
	Person p = <jk>new</jk> Person(1, <js>"John Smith"</js>);

	<jc>// Serialize the bean to JSON.</jc>
	String json = s.serialize(p);
	</p>
	<p>
		We could have also created a new serializer with the same settings using the following code:
	</p>
	<p class='bcode'>
	JsonSerializer s = JsonSerializer.<jsm>create</jsm>().simple().ws().sq().build();
	</p>
	
	<p>
		The code above produces the following output:
	</p>
	<p class='bcode'>
	{
		id: <jk>1</jk>, 
		name: <js>'John Smith'</js>
	}
	</p>
	

	<!-- ======================================================================================================== -->
	<a id="JsonSchemaSupport"></a>
	<h3 class='topic' onclick='toggle(this)'>2.3 - JSON-Schema support</h3>
	<div class='topic'>
		<p>
			Juneau provides the {@link org.apache.juneau.json.JsonSchemaSerializer} class for generating JSON-Schema 
			documents that describe the output generated by the {@link org.apache.juneau.json.JsonSerializer} class.
			<br>This class shares the same properties as <code>JsonSerializer</code>.
			<br>For convenience the {@link org.apache.juneau.json.JsonSerializer#getSchemaSerializer()} method has been 
			added for creating instances of schema serializers from the regular serializer instance.
		</p>
		<p>
			<i>Note:</i> As of this writing, JSON-Schema has not been standardized, so the output generated by the 
			schema serializer may be subject to future modifications.
		</p>
		<p>
			Lets start with the classes from the previous examples:
		</p>
		<p class='bcode'>
	<jk>public class</jk> Person {
		<jc>// Bean properties</jc>
		<jk>public int</jk> <jf>id</jf>;
		<jk>public</jk> String <jf>name</jf>;
		<jk>public</jk> URI <jf>uri</jf>;
		<jk>public</jk> URI <jf>addressBookUri</jf>;
		<ja>@BeanProperty</ja>(swap=CalendarSwap.ISO8601DTZ.<jk>class</jk>) <jk>public</jk> Calendar <jf>birthDate</jf>;
		<jk>public</jk> LinkedList&lt;Address&gt; <jf>addresses</jf> = <jk>new</jk> LinkedList&lt;Address&gt;();

		<jc>// Bean constructor (needed by parser)</jc>
		<jk>public</jk> Person() {}

		<jc>// Normal constructor</jc>
		<jk>public</jk> Person(<jk>int</jk> id, String name, String uri, String addressBookUri, String birthDate) <jk>throws</jk> Exception {
			<jk>this</jk>.<jf>id</jf> = id;
			<jk>this</jk>.<jf>name</jf> = name;
			<jk>this</jk>.<jf>uri</jf> = <jk>new</jk> URI(uri);
			<jk>this</jk>.<jf>addressBookUri</jf> = <jk>new</jk> URI(addressBookUri);
			<jk>this</jk>.<jf>birthDate</jf> = <jk>new</jk> GregorianCalendar();
			<jk>this</jk>.<jf>birthDate</jf>.setTime(DateFormat.getDateInstance(DateFormat.<jsf>MEDIUM</jsf>).parse(birthDate));
		}
	}

	<jk>public class</jk> Address {
		<jc>// Bean properties</jc>
		<jk>public</jk> URI <jf>uri</jf>;
		<jk>public</jk> URI <jf>personUri</jf>;
		<jk>public int</jk> <jf>id</jf>;
		<jk>public</jk> String <jf>street</jf>, <jf>city</jf>, <jf>state</jf>;
		<jk>public int</jk> <jf>zip</jf>;
		<jk>public boolean</jk> <jf>isCurrent</jf>;
	}
		</p>
		<p>
			The code for creating our POJO model and generating JSON-Schema is shown below:
		</p>
		<p class='bcode'>
	<jc>// Get the schema serializer for one of the default JSON serializers.</jc>
	JsonSchemaSerializer s = JsonSerializer.<jsf>DEFAULT_LAX_READABLE</jsf>.getSchemaSerializer();

	<jc>// Create our bean.</jc>
	Person p = <jk>new</jk> Person(1, <js>"John Smith"</js>, <js>"http://sample/addressBook/person/1"</js>, 
		<js>"http://sample/addressBook"</js>, <js>"Aug 12, 1946"</js>);
	Address a = <jk>new</jk> Address();
	a.<jf>uri</jf> = <jk>new</jk> URI(<js>"http://sample/addressBook/address/1"</js>);
	a.<jf>personUri</jf> = <jk>new</jk> URI(<js>"http://sample/addressBook/person/1"</js>);
	a.<jf>id</jf> = 1;
	a.<jf>street</jf> = <js>"100 Main Street"</js>;
	a.<jf>city</jf> = <js>"Anywhereville"</js>;
	a.<jf>state</jf> = <js>"NY"</js>;
	a.<jf>zip</jf> = 12345;
	a.<jf>isCurrent</jf> = <jk>true</jk>;
	p.<jf>addresses</jf>.add(a);

	<jc>// Get the JSON Schema corresponding to the JSON generated above.</jc>
	String jsonSchema = s.serialize(p);
		</p>
		
		<h5 class='figure'>Results</h5>
		<p class='bcode'>
	{
		type: <js>'object'</js>, 
		description: <js>'org.apache.juneau.sample.Person'</js>, 
		properties: {
			id: {
				type: <js>'number'</js>, 
				description: <js>'int'</js>
			}, 
			name: {
				type: <js>'string'</js>, 
				description: <js>'java.lang.String'</js>
			}, 
			uri: {
				type: <js>'any'</js>, 
				description: <js>'java.net.URI'</js>
			}, 
			addressBookUri: {
				type: <js>'any'</js>, 
				description: <js>'java.net.URI'</js>
			}, 
			birthDate: {
				type: <js>'any'</js>, 
				description: <js>'java.util.Calendar'</js>
			}, 
			addresses: {
				type: <js>'array'</js>, 
				description: <js>'java.util.LinkedList&lt;org.apache.juneau.sample.Address&gt;'</js>, 
				items: {
					type: <js>'object'</js>, 
					description: <js>'org.apache.juneau.sample.Address'</js>, 
					properties: {
						uri: {
							type: <js>'any'</js>, 
							description: <js>'java.net.URI'</js>
						}, 
						personUri: {
							type: <js>'any'</js>, 
							description: <js>'java.net.URI'</js>
						}, 
						id: {
							type: <js>'number'</js>, 
							description: <js>'int'</js>
						}, 
						street: {
							type: <js>'string'</js>, 
							description: <js>'java.lang.String'</js>
						}, 
						city: {
							type: <js>'string'</js>, 
							description: <js>'java.lang.String'</js>
						}, 
						state: {
							type: <js>'string'</js>, 
							description: <js>'java.lang.String'</js>
						}, 
						zip: {
							type: <js>'number'</js>, 
							description: <js>'int'</js>
						}, 
						isCurrent: {
							type: <js>'boolean'</js>, 
							description: <js>'boolean'</js>
						}
					}
				}
			}
		}
	}
		</p>
	</div>

</div>


<!-- ======================================================================================================== -->
<a id="JsonParser"></a>
<h2 class='topic' onclick='toggle(this)'>3 - JsonParser class</h2>
<div class='topic'>
	<p>
		The {@link org.apache.juneau.json.JsonParser} class is the class used to parse JSON back into POJOs.
	</p>	
	<p>
		The JSON parser supports ALL valid JSON, including:
	</p>
	<ul class='spaced-list'>
		<li>
			Javascript comments.
		<li>
			Single or double quoted values.
		<li>
			Quoted (strict) or unquoted (non-strict) attributes.
		<li>
			JSON fragments (such as string, numeric, or boolean primitive values).
		<li>
			Concatenated strings. 
	</ul>	
	<p>
		A static reusable instance of <code>JsonParser</code> is also provided for convenience:
	</p>
	<ul>
		<li>{@link org.apache.juneau.json.JsonParser#DEFAULT}
	</ul>
	<p>
		Let's build upon the previous example and parse the generated JSON back into the original bean.
		<br>We start with the JSON that was generated.
	</p>
	<p class='bcode'>
	<jc>// Use serializer with readable output, simple mode.</jc>
	JsonSerializer s = JsonSerializer.<jsf>DEFAULT_LAX_READABLE</jsf>;

	<jc>// Create our bean.</jc>
	Person p = <jk>new</jk> Person(1, <js>"John Smith"</js>, <js>"http://sample/addressBook/person/1"</js>, 
		<js>"http://sample/addressBook"</js>, <js>"Aug 12, 1946"</js>);
	Address a = <jk>new</jk> Address();
	a.<jf>uri</jf> = <jk>new</jk> URI(<js>"http://sample/addressBook/address/1"</js>);
	a.<jf>personUri</jf> = <jk>new</jk> URI(<js>"http://sample/addressBook/person/1"</js>);
	a.<jf>id</jf> = 1;
	a.<jf>street</jf> = <js>"100 Main Street"</js>;
	a.<jf>city</jf> = <js>"Anywhereville"</js>;
	a.<jf>state</jf> = <js>"NY"</js>;
	a.<jf>zip</jf> = 12345;
	a.<jf>isCurrent</jf> = <jk>true</jk>;
	p.<jf>addresses</jf>.add(a);	

	<jc>// Serialize the bean to JSON.</jc>
	String json = s.serialize(p);
	</p>
	<p>
		This code produced the following:
	</p>
	<p class='bcode'>
	{
		id: <jk>1</jk>, 
		name: <js>'John Smith'</js>, 
		uri: <js>'http://sample/addressBook/person/1'</js>, 
		addressBookUri: <js>'http://sample/addressBook'</js>, 
		birthDate: <js>'1946-08-12T00:00:00Z'</js>, 
		addresses: [
			{
				uri: <js>'http://sample/addressBook/address/1'</js>, 
				personUri: <js>'http://sample/addressBook/person/1'</js>, 
				id: <jk>1</jk>, 
				street: <js>'100 Main Street'</js>, 
				city: <js>'Anywhereville'</js>, 
				state: <js>'NY'</js>, 
				zip: <jk>12345</jk>, 
				isCurrent: <jk>true</jk>
			}
		]
	}
	</p>
	<p>
		The code to convert this back into a bean is:
	</p>
	<p class='bcode'>
	<jc>// Parse it back into a bean using the reusable JSON parser.</jc>
	Person p = JsonParser.<jsf>DEFAULT</jsf>.parse(json, Person.<jk>class</jk>);

	<jc>// Render it back as JSON.</jc>
	json = JsonSerializer.<jsf>DEFAULT_LAX_READABLE</jsf>.serialize(p);
	</p>
	<p>
		We print it back out to JSON to show that all the data has been preserved:
	</p>
	<p class='bcode'>
	{
		id: <jk>1</jk>, 
		name: <js>'John Smith'</js>, 
		uri: <js>'http://sample/addressBook/person/1'</js>, 
		addressBookUri: <js>'http://sample/addressBook'</js>, 
		birthDate: <js>'1946-08-12T00:00:00Z'</js>, 
		addresses: [
			{
				uri: <js>'http://sample/addressBook/address/1'</js>, 
				personUri: <js>'http://sample/addressBook/person/1'</js>, 
				id: <jk>1</jk>, 
				street: <js>'100 Main Street'</js>, 
				city: <js>'Anywhereville'</js>, 
				state: <js>'NY'</js>, 
				zip: <jk>12345</jk>, 
				isCurrent: <jk>true</jk>
			}
		]
	}	
	</p>
</div>
<p align="center"><i><b>*** fín ***</b></i></p>

</body>
</html>